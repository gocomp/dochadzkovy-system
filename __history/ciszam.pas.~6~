unit ciszam;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.StdCtrls, Vcl.Mask, RzEdit,
  Activex,
  RzDBEdit, RzPanel, RzButton, Vcl.Grids, Riss_Devices_TLB, Vcl.DBGrids,
  RzDBGrid, Vcl.ExtCtrls,
  Vcl.DBCtrls;

type
  Tciszamest = class(TForm)
    Panel1: TPanel;
    RzDBGrid1: TRzDBGrid;
    RzButton1: TRzButton;
    RzButton2: TRzButton;
    RzButton3: TRzButton;
    RzPanel1: TRzPanel;
    RzButton4: TRzButton;
    RzDBEdit1: TRzDBEdit;
    StaticText1: TStaticText;
    RzButton5: TRzButton;
    StaticText2: TStaticText;
    RzDBEdit2: TRzDBEdit;
    RzDBEdit4: TRzDBEdit;
    StaticText3: TStaticText;
    StaticText4: TStaticText;
    RzDBEdit5: TRzDBEdit;
    RzDBEdit6: TRzDBEdit;
    StaticText5: TStaticText;
    StaticText6: TStaticText;
    DBLookupComboBox1: TDBLookupComboBox;
    Button1: TButton;
    Button2: TButton;
    procedure RzButton1Click(Sender: TObject);
    procedure RzButton3Click(Sender: TObject);
    procedure RzButton2Click(Sender: TObject);
    procedure RzButton5Click(Sender: TObject);
    procedure RzButton4Click(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  ciszamest: Tciszamest;

implementation

uses CMFrm, CommonUnt, EnrollFrm;
{$R *.dfm}

procedure Tciszamest.Button1Click(Sender: TObject);
var
  extraData: PSafeArray;
  extraProperty: PSafeArray;
  bRet: Boolean;
  user: IUserExt;
  i: integer;
begin
  // Set user name
  for i := 1 to 1 do
   begin
    CMForm.opendev(i);

    extraProperty := CreateSafeArray(2);
    extraData := CreateSafeArray(6);
    user := CoUserExt.Create;

    user.DIN := Trim(inttostr(CMForm.Zamestid.Value));
    user.UserName := Trim(CMForm.ZamestPriezvisko.Value + ' ' +
      CMForm.ZamestMeno.Value);
    bRet := gDeviceConnection.SetPropertyExt(UserProperty_UserName,
      extraProperty, user, extraData);
    if bRet then
    begin
      ShowMessage('Odoslane');
    end
    else
    begin
      ShowMessage('set user name: Fail');
    end;


    CMForm.closedev;
  end;
end;

procedure Tciszamest.Button2Click(Sender: TObject);
begin
 EnrollForm := TEnrollForm.Create(Application);
  try
    EnrollForm.ShowModal;
  finally
    EnrollForm.Free;
  end;
end;

procedure Tciszamest.RzButton1Click(Sender: TObject);
begin
  close;
end;

procedure Tciszamest.RzButton2Click(Sender: TObject);
begin
  Panel1.Enabled := false;
  RzPanel1.Visible := true;
  RzDBEdit1.Focused;
  CMForm.Zamest.Insert;
end;

procedure Tciszamest.RzButton3Click(Sender: TObject);
var
  buttonSelected: integer;
begin
  // Show a confirmation dialog
  buttonSelected :=
    messagedlg('RFID ' + inttostr(CMForm.cislokartycislokarty.Value) + '.' +
    chr(10) + chr(13) + ' Naozaj chcete vymazaù?', mtError, mbOKCancel, 0);

  // Show the button type selected
  if buttonSelected = mrOK then
  begin
    if not CMForm.cislokartyused.Value then
    begin
      CMForm.cislokarty.Delete;
      ShowMessage('VymazanÈ');
    end
    else
    begin
      ShowMessage('RFID sa pouûÌv·!!! NevymazanÈ');
    end

  end;

end;

procedure Tciszamest.RzButton4Click(Sender: TObject);
begin
  CMForm.Zamest.cancel;
  RzPanel1.Visible := false;
  Panel1.Enabled := true;
  RzDBGrid1.Focused;
end;

procedure Tciszamest.RzButton5Click(Sender: TObject);
begin
  CMForm.Zamest.post;

  RzPanel1.Visible := false;

  Panel1.Enabled := true;
  RzDBGrid1.Focused;
end;

end.
